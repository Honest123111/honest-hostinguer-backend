runtime: python
pythonVersion: "3.11"

nodeVersion: "20"

build:
  steps:
    - name: "Install frontend dependencies"
      entrypoint: bash
      args:
        - -c
        - "cd honest-angular && npm install"
    - name: "Build Angular frontend"
      entrypoint: bash
      args:
        - -c
        - "cd honest-angular && npm run build"
    - name: "Copy frontend to Django static folder"
      entrypoint: bash
      args:
        - -c
        - "mkdir -p staticfiles && cp -r honest-angular/dist/honest-angular/browser/* staticfiles/"
    - name: "Install Python dependencies"
      entrypoint: bash
      args:
        - -c
        - "pip install -r requirements.txt"
    - name: "Collect Django static files"
      entrypoint: bash
      args:
        - -c
        - "python manage.py collectstatic --noinput"

env:
  - variable: "DEBUG"
    value: "False"
  - variable: "ALLOWED_HOSTS"
    value: "*"

runConfig:
  entrypoint: bash
  args:
    - -c
    - "gunicorn honestdb_project.wsgi:application --bind 0.0.0.0:8080"
